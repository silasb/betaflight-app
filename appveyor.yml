version: "{build}"

image:
  - Visual Studio 2015

clone_folder: c:\project

environment:
  GOPATH: c:\gopath
  DEPTESTBYPASS501: 1

cache:
  - c:\gopath -> go.mod
  - node_modules

# scripts that run after cloning repository
install:
  - cinst mingw
  - cinst upx
  - set PATH=%GOPATH%\bin;c:\go\bin;C:\tools\mingw64\bin;%PATH%
  - gcc -v
  - go version
  - go env
  - go get -u golang.org/x/vgo
  - go get -u github.com/jteeuwen/go-bindata/...
  - vgo list -m
  - npm install -g yarn
  - yarn install

build_script:
  - yarn version:windows:amd64
  - ps: cd dist && (get-item *.exe).Name | upx

artifacts:
  - path: dist
    name: app
    type: zip

# to disable automatic tests
test: off

deploy:
- provider: FTP
  host: foo.us.to
  protocol: sftp
  username: silas
  password:
    secure: GuE6nDVCzvU4W9jzR+4YcA==
  folder: www/foo.us.to/html/gui2
  application: app

# init:
#   - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
# on_finish:
#   - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
